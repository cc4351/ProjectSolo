<!doctype html>
<html>
	<head>
		<title>D3-line</title>
		<script src = "http://d3js.org/d3.v3.min.js"></script>
		<style>
			.path {
			  stroke-dasharray: 1000;
			  stroke-dashoffset: 1000;
			  animation: dash 5s linear alternate infinite;
			}

			@keyframes dash {
			  from {
				stroke-dashoffset: 822;
			  }
			  to {
				stroke-dashoffset: 0;
			  }
			}
		</style>

	</head>

	
	<body>
<!--		<p>D3 practices</p>-->
<!--
		<svg viewBox="0 0 340 333">

		  <path class="path" fill="white" stroke="black" stroke-width="4" d="M66.039,133.545c0,0-21-57,18-67s49-4,65,8
			s30,41,53,27s66,4,58,32s-5,44,18,57s22,46,0,45s-54-40-68-16s-40,88-83,48s11-61-11-80s-79-7-70-41
			C46.039,146.545,53.039,128.545,66.039,133.545z"/>

		</svg>
-->
		
		<script>
			
			var svgContainer = d3.select("body").append("svg")
							 .attr("width", 500)
							 .attr("height", 600);
			
			
			var nodeData = [{ x: 100, y: 110 },
							{ x: 83, y: 43 },
							{ x: 92, y: 28 },
							{ x: 49, y: 74 },
							{ x: 51, y: 10 },
							{ x: 25, y: 98 },
							{ x: 77, y: 30 },
							{ x: 20, y: 83 },
							{ x: 11, y: 63 },
							{ x:  4, y: 55 },
							{ x:  0, y:  0 },
							{ x: 85, y: 100 },
							{ x: 60, y: 40 },
							{ x: 70, y: 80 },
							{ x: 10, y: 20 },
							{ x: 40, y: 50 },
							{ x: 25, y: 31 }
						  ];
			
			
			var circleAttrs = {
				  cx: function(d) { return d.x*3; },
				  cy: function(d) { return d.y*3; },
				  id: function(d, i){return "n"+i;},
				  r: 5,
			  };
			
			
			//draw all the circles/nodes
			var nodes = svgContainer.selectAll("circle")
						  .data(nodeData)
						  .enter()
						  .append("circle")
						  .attr(circleAttrs);
			
		
			//more automation could be done here to compute pathLength
//			var lineData = [{from: 1, to: 2, x1: 100, y1: 110, x2: 83, y2: 43, len: 70}, 
//						    {from: 2, to: 3, x1: 83, y1: 43, x2: 92, y2: 28, len: 17.49}
//						   ];
			
			//if necessary, change the identifier to id instead of index
			var connect = [{from: 0, to: 1},
						   {from: 1, to: 2},
						   {from: 3, to: 1},
						   {from: 1, to: 15},
						   {from: 15, to: 5},
						   {from: 15, to: 6},
						   {from: 7, to: 15}];
			
			var pt1, pt2, x1, x2, y1, y2, len, tmp;
			var lineData = [];
			
			/*
			javascript for loop tidbits: https://stackoverflow.com/questions/8681593/does-javascript-have-an-enhanced-for-loop-syntax-similar-to-javas
			*/
			for(i = 0; i<connect.length; i++){
				pt1 = nodeData[connect[i].from];
				pt2 = nodeData[connect[i].to];
				x1 = pt1.x;
				y1 = pt1.y;
				x2 = pt2.x;
				y2 = pt2.y;
				//square runtime performance: https://stackoverflow.com/questions/26593302/whats-the-fastest-way-to-square-a-number-in-javascript/53663890
				len = Math.sqrt((x1-x2)**2 + (y1-y2)**2);
				tmp = {from: 'n'+connect[i].from, to: 'n'+connect[i].to, x1: x1, y1: y1, x2: x2, y2: y2, len: len, id: 'l'+i};
				lineData.push(tmp);
				if(pt1.hasOwnProperty("link")){
					pt1.link.push('l'+i);
				}else{
					pt1.link = ['l'+i];
				}
				if(pt2.hasOwnProperty("link")){
					pt2.link.push('l'+i);
				}else{
					pt2.link = ['l'+i];
				}
				console.log("node 1: "+'#n'+tmp.from);
				d3.select('#'+tmp.from).attr("fill", "red");
				d3.select('#'+tmp.to).attr("fill", "red");
				
			}
			
			console.log(nodeData);
			
			var lineAttrs = {
				x1: function(d){ return d.x1*3;},
				x2: function(d){ return d.x2*3;},
				y1: function(d){ return d.y1*3;},
				y2: function(d){ return d.y2*3;},
				stroke: "black",
				"stroke-width": 2,
				opacity: 0.5,
				id: function(d){return d.id;},
				pathLength: function(d){return d.len*3;}
			};
			
		
		    //draw all the lines/links
			lines = svgContainer.selectAll("line")
						.data(lineData)
						.enter()
						.append("line")
						.attr(lineAttrs);
			
			//animation on connection
			lines.each(function(){
				var dashlen = d3.select(this).attr("pathLength");
				d3.select(this).attr("stroke-dasharray",  dashlen+ " "+dashlen)
								.attr("stroke-dashoffset", dashlen)
								.transition()
								.delay(1000)
								.duration(2000)
								.ease("linear")
								.attr("stroke-dashoffset", 0);
			});
				
//			var node, lines, tmp_line;
//			for(i = 0; i<lineData.length; i++){
//					tmp_line = lineData[i];
//					if(node.localeCompare(tmp_line.from == 0 ||node.localeCompare(tmp_line.to == 0){
//						lines.push("#" + tmp_line.id);
//					}
//				}
			
			var nd, node, ind, data;
			nodes.each(function(){
				d3.select(this).on("click", function(){
					node = this.id;
//					console.log(node);
					ind = parseInt(String(node).replace('n', ''));
//					console.log(ind);
					data = nodeData[ind];
//					console.log(data);
					if(data.hasOwnProperty("link")){
						var links = data["link"];
//						console.log(links);
						for(i=0; i<links.length; i++){
							var lk = d3.select("#" + links[i]);
//							console.log(lk.attr("opacity"));
							var newOpacity =lk.attr("opacity")==0.5?0:0.5;
							console.log("newOpac: "+ newOpacity);
							lk.attr("opacity", newOpacity);
						}
					}
				
				});
			});
		
			
		

			

				
		</script>
	
	</body>

</html>



